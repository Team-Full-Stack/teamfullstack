<!DOCTYPE html> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Automating Go-Releaser with GCP Cloud Build for Artifact Storage | Team Full Stack</title> <meta name="author" content="Team Full. Stack"> <meta name="description" content="A step-by-step guide to running Go-Releaser within GCP Cloud Build and uploading generated artifacts to Google Cloud Storage, organized by version."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.22.1/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?19f3075a2d19613090fe9e16b564e1fe" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/profile.jpeg?b6d31c5b86e524b5e43cba1d5ca33348"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://blog.teamfullstack.io//blog/2024/Gcp-Go-Releaser/"> <link rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?e74e74bf055e5729d44a7d031a5ca6a5" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?96d6b3e1c3604aca8b6134c7afdd5db6"></script> <script src="/assets/js/dark_mode.js?9b17307bb950ffa2e34be0227f53558f"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?7b30caa5023af4af8408a472dc4e1ebb"></script> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src="/assets/js/distillpub/template.v2.js"></script> <script src="/assets/js/distillpub/transforms.v2.js"></script> <script src="/assets/js/distillpub/overrides.js"></script> <style type="text/css">.fake-img{background:#bbb;border:1px solid rgba(0,0,0,0.1);box-shadow:0 0 4px rgba(0,0,0,0.1);margin-bottom:12px}.fake-img p{font-family:monospace;color:white;text-align:left;margin:12px 0;text-align:center;font-size:16px}</style> </head> <body> <d-front-matter> <script async type="text/json">{
      "title": "Automating Go-Releaser with GCP Cloud Build for Artifact Storage",
      "description": "A step-by-step guide to running Go-Releaser within GCP Cloud Build and uploading generated artifacts to Google Cloud Storage, organized by version.",
      "published": "September 9, 2024",
      "authors": [
        {
          "author": "Usman Jamil Bhatti",
          "authorURL": "https://github.com/usman-jamil",
          "affiliations": [
            {
              "name": "Allied Consultants",
              "url": ""
            }
          ]
        },
        {
          "author": "Sheikh Luqman",
          "authorURL": "https://github.com/luqmant51",
          "affiliations": [
            {
              "name": "Allied Consultants",
              "url": ""
            }
          ]
        },
        {
          "author": "Zuhaib Sohail",
          "authorURL": "https://github.com/ZuhaibSohail163",
          "affiliations": [
            {
              "name": "Allied Consultants",
              "url": ""
            }
          ]
        }
        
      ],
      "katex": {
        "delimiters": [
          {
            "left": "$",
            "right": "$",
            "display": false
          },
          {
            "left": "$$",
            "right": "$$",
            "display": true
          }
        ]
      }
    }</script> </d-front-matter> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Team Full Stack</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/people/">people</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="post distill"> <d-title> <h1>Automating Go-Releaser with GCP Cloud Build for Artifact Storage</h1> <p>A step-by-step guide to running Go-Releaser within GCP Cloud Build and uploading generated artifacts to Google Cloud Storage, organized by version.</p> </d-title><d-byline></d-byline><d-article> <d-contents> <nav class="l-text figcaption"> <h3>Contents</h3> <div><a href="#introduction">Introduction</a></div> <div><a href="#prerequisites">Prerequisites</a></div> <div><a href="#setting-up-go-releaser-in-gcp-cloud-build">Setting Up Go-Releaser in GCP Cloud Build</a></div> <ul> <li><a href="#create-the-cloud-build-configuration">Create the Cloud Build Configuration</a></li> <li><a href="#configure-go-releaser">Configure Go-Releaser</a></li> <li><a href="#running-the-build">Running the Build</a></li> </ul> <div><a href="#uploading-artifacts-to-google-cloud-storage">Uploading Artifacts to Google Cloud Storage</a></div> <div><a href="#conclusion">Conclusion</a></div> </nav> </d-contents> <h2 id="introduction">Introduction</h2> <p>Continuous integration and continuous delivery (CI/CD) are crucial for modern software development, and automating these processes can save significant time and reduce errors. In this guide, we’ll walk through the steps to run Go-Releaser within Google Cloud Platform (GCP) Cloud Build and upload the generated artifacts into Google Cloud Storage (GCS). Each release version will be organized into its own folder in GCS, making it easy to manage and retrieve specific versions of your software.</p> <h2 id="prerequisites">Prerequisites</h2> <p>Before we get started, ensure you have the following prerequisites in place:</p> <ul> <li> <strong>Google Cloud Platform Account</strong>: You need access to a GCP project with billing enabled.</li> <li> <strong>Go-Releaser</strong>: Installed on your local machine for initial setup and testing.</li> <li> <strong>Google Cloud SDK</strong>: Installed and configured on your machine.</li> <li> <strong>Cloud Build API</strong>: Enabled in your GCP project.</li> <li> <strong>Google Cloud Storage Bucket</strong>: Created for storing the release artifacts.</li> </ul> <h2 id="setting-up-go-releaser-in-gcp-cloud-build">Setting Up Go-Releaser in GCP Cloud Build</h2> <h3 id="1-create-the-cloud-build-configuration">1. Create the Cloud Build Configuration</h3> <p>First, we’ll define a <code class="language-plaintext highlighter-rouge">cloudbuild.yaml</code> file to automate the build process using GCP Cloud Build. This file describes the steps needed to run Go-Releaser and upload the artifacts.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">steps</span><span class="pi">:</span>
  <span class="c1"># Step 1: Set up Go environment with Go 1.23.0</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">golang:1.23.0'</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s1">'</span><span class="s">setup-go'</span>
    <span class="na">entrypoint</span><span class="pi">:</span> <span class="s1">'</span><span class="s">bash'</span>
    <span class="na">args</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">-c'</span>
      <span class="pi">-</span> <span class="pi">|</span>
        <span class="s">go version</span>
        <span class="s">go mod download  # Download Go module dependencies</span>

  <span class="c1"># Step 2: Run GoReleaser using its Docker image</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">goreleaser/goreleaser:latest'</span>
    <span class="na">id</span><span class="pi">:</span> <span class="s1">'</span><span class="s">run-goreleaser'</span>
    <span class="na">entrypoint</span><span class="pi">:</span> <span class="s1">'</span><span class="s">bash'</span>
    <span class="na">args</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s1">'</span><span class="s">-c'</span>
      <span class="pi">-</span> <span class="pi">|</span>
        <span class="s">goreleaser release --snapshot</span>
  <span class="c1"># Upload artifacts to Google Cloud Storage</span>
  <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s2">"</span><span class="s">Upload</span><span class="nv"> </span><span class="s">dist</span><span class="nv"> </span><span class="s">to</span><span class="nv"> </span><span class="s">storage"</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">gcr.io/google.com/cloudsdktool/cloud-sdk:slim'</span>
    <span class="na">automapSubstitutions</span><span class="pi">:</span> <span class="kc">true</span>
    <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
      <span class="s">#!/usr/bin/env bash</span>
      <span class="s">if [ ! -z "$TAG_NAME" ]; then</span>
        <span class="s">gcloud storage cp --recursive ./dist/* gs://$Your_Bucket_Name/main/$TAG_NAME/</span>
      <span class="s">else</span>
        <span class="s">gcloud storage cp --recursive ./dist/* gs://$Your_Bucket_Name/main/dist/</span>
      <span class="s">fi</span>
<span class="na">options</span><span class="pi">:</span>
  <span class="na">logging</span><span class="pi">:</span> <span class="s">CLOUD_LOGGING_ONLY</span>

  <span class="na">pool</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">projects/$PROJECT_ID/locations/us-central1/workerPools/$Your_Private_Pool_Name'</span>
</code></pre></div></div> <ul> <li> <code class="language-plaintext highlighter-rouge">Steps</code>: This block defines tasks that Cloud Build performs in sequence, from setting up the environment to uploading artifacts to GCS.</li> <li> <code class="language-plaintext highlighter-rouge">Name</code>: Specifies the Docker image used in the build process. For example, <code class="language-plaintext highlighter-rouge">golang:1.23.0 pulls</code> a Go image, while <code class="language-plaintext highlighter-rouge">goreleaser/goreleaser:latest</code> pulls the GoReleaser image.</li> <li> <code class="language-plaintext highlighter-rouge">Id</code>: Gives each step an optional identifier for logging or reference purposes.</li> <li> <code class="language-plaintext highlighter-rouge">Entrypoint</code>: Specifies the default command that will run inside the container. In this example, it is set to <code class="language-plaintext highlighter-rouge">bash</code>.</li> <li> <code class="language-plaintext highlighter-rouge">Args</code>: Contains the commands or shell script to execute. For example, <code class="language-plaintext highlighter-rouge">go mod download</code> downloads the Go dependencies, and <code class="language-plaintext highlighter-rouge">goreleaser release --snapshot</code> generates the release artifacts.</li> <li> <code class="language-plaintext highlighter-rouge">AutomapSubstitutions</code>: Allows variable substitution, e.g., for dynamic bucket or branch names.</li> <li> <code class="language-plaintext highlighter-rouge">Script</code>: Bash commands that run during the build step. For example, the <code class="language-plaintext highlighter-rouge">gcloud storage cp</code> command copies the build artifacts to a specified GCS bucket.</li> </ul> <h3 id="2-create-the-go-releaser-configuration">2. Create the Go Releaser Configuration</h3> <p>Create a <code class="language-plaintext highlighter-rouge">.goreleaser.yml</code> configuration file in your project root. This file tells Go-Releaser how to build and package your application.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="m">2</span>
<span class="na">before</span><span class="pi">:</span>
  <span class="na">hooks</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">go mod tidy</span>
<span class="na">builds</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">env</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">CGO_ENABLED=0</span>
    <span class="na">goos</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">linux</span>
      <span class="pi">-</span> <span class="s">windows</span>
      <span class="pi">-</span> <span class="s">darwin</span>
    <span class="na">goarch</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">amd64</span>
      <span class="pi">-</span> <span class="s">arm</span>
      <span class="pi">-</span> <span class="s">arm64</span>
<span class="na">release</span><span class="pi">:</span>
  <span class="na">disable</span><span class="pi">:</span> <span class="s">trueES</span>

<span class="na">archives</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">format</span><span class="pi">:</span> <span class="s">tar.gz</span>
    <span class="c1"># this name template makes the OS and Arch compatible with the results of `uname`.</span>
    <span class="na">name_template</span><span class="pi">:</span> <span class="pi">&gt;-</span>
      <span class="s">__x86_64i386v</span>
    <span class="c1"># use zip for windows archives</span>
    <span class="na">format_overrides</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">goos</span><span class="pi">:</span> <span class="s">windows</span>
        <span class="na">format</span><span class="pi">:</span> <span class="s">zip</span>
<span class="na">changelog</span><span class="pi">:</span>
  <span class="na">sort</span><span class="pi">:</span> <span class="s">asc</span>
  <span class="na">filters</span><span class="pi">:</span>
    <span class="na">exclude</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">^docs:"</span>
      <span class="pi">-</span> <span class="s2">"</span><span class="s">^test:"</span>
</code></pre></div></div> <ul> <li> <code class="language-plaintext highlighter-rouge">Version</code>: The version of Go-Releaser configuration.</li> <li> <code class="language-plaintext highlighter-rouge">Before.hooks</code>: Commands to run before the main build process begins. Here, go mod tidy ensures that the Go module dependencies are clean and up-to-date.</li> <li> <code class="language-plaintext highlighter-rouge">Builds</code>: Defines the builds that Go-Releaser should produce. This includes specifying the operating systems (goos) and architectures (goarch) you want to support. In this example, Linux, Windows, and macOS are supported across different CPU architectures.</li> <li> <code class="language-plaintext highlighter-rouge">CGO_ENABLED=0</code>: This environment variable ensures that the Go build process uses pure Go, which avoids dependencies on C libraries.</li> <li> <code class="language-plaintext highlighter-rouge">Archives</code>: Specifies how the build output should be packaged (e.g., tar.gz for Unix-like systems and zip for Windows).</li> <li> <code class="language-plaintext highlighter-rouge">Name_template</code>: Defines the naming format for the output artifacts based on the OS and architecture.</li> <li> <code class="language-plaintext highlighter-rouge">Changelog</code>: Customizes how the changelog is generated. In this case, commits that start with docs: or test: are excluded from the changelog.</li> </ul> </d-article> <d-appendix> <d-footnote-list></d-footnote-list> <d-citation-list></d-citation-list> </d-appendix> <d-bibliography src="/assets/bibliography/2024-09-09-Go-Releaser.bib"></d-bibliography> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2024 Team Full. Stack. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>